<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android"
	xmlns:app="http://schemas.android.com/apk/res-auto"
	xmlns:tools="http://schemas.android.com/tools">

	<data>
		<variable
			name="viewModel"
			type="com.kulenina.questix.viewmodel.UserViewModel" />
	</data>

	<androidx.constraintlayout.widget.ConstraintLayout
		android:layout_width="match_parent"
		android:layout_height="match_parent"
		tools:context=".fragment.UserProfileFragment">

		<!-- Loading State -->
		<LinearLayout
			android:id="@+id/layoutLoading"
			android:layout_width="match_parent"
			android:layout_height="match_parent"
			android:orientation="vertical"
			android:gravity="center"
			android:visibility="@{viewModel.isLoading ? android.view.View.VISIBLE : android.view.View.GONE}"
			app:layout_constraintTop_toTopOf="parent"
			app:layout_constraintBottom_toBottomOf="parent"
			app:layout_constraintStart_toStartOf="parent"
			app:layout_constraintEnd_toEndOf="parent">

			<ProgressBar
				android:layout_width="wrap_content"
				android:layout_height="wrap_content"
				android:layout_marginBottom="16dp" />

			<TextView
				android:layout_width="wrap_content"
				android:layout_height="wrap_content"
				android:text="Loading user profile..."
				android:textSize="16sp"
				android:textColor="@android:color/darker_gray" />

		</LinearLayout>

		<!-- Error State -->
		<LinearLayout
			android:id="@+id/layoutError"
			android:layout_width="match_parent"
			android:layout_height="match_parent"
			android:orientation="vertical"
			android:gravity="center"
			android:visibility="@{viewModel.errorMessage != null ? android.view.View.VISIBLE : android.view.View.GONE}"
			app:layout_constraintTop_toTopOf="parent"
			app:layout_constraintBottom_toBottomOf="parent"
			app:layout_constraintStart_toStartOf="parent"
			app:layout_constraintEnd_toEndOf="parent">

			<TextView
				android:layout_width="wrap_content"
				android:layout_height="wrap_content"
				android:text="@{viewModel.errorMessage}"
				android:textSize="16sp"
				android:textColor="@android:color/holo_red_dark"
				android:gravity="center"
				android:layout_margin="16dp" />

		</LinearLayout>

		<!-- Main Content -->
		<ScrollView
			android:layout_width="match_parent"
			android:layout_height="match_parent"
			android:visibility="@{!viewModel.isLoading &amp;&amp; viewModel.errorMessage == null ? android.view.View.VISIBLE : android.view.View.GONE}"
			app:layout_constraintTop_toTopOf="parent"
			app:layout_constraintBottom_toBottomOf="parent"
			app:layout_constraintStart_toStartOf="parent"
			app:layout_constraintEnd_toEndOf="parent">

			<LinearLayout
				android:id="@+id/layoutMainContent"
				android:layout_width="match_parent"
				android:layout_height="wrap_content"
				android:orientation="vertical">

			<!-- User Avatar and Info Card -->
			<androidx.cardview.widget.CardView
				android:id="@+id/profileCard"
				android:layout_width="match_parent"
				android:layout_height="wrap_content"
				android:layout_marginTop="16dp"
				android:layout_marginStart="16dp"
				android:layout_marginEnd="16dp"
				android:layout_marginBottom="8dp"
				android:elevation="4dp"
				app:cardCornerRadius="12dp"
				app:cardElevation="4dp">

				<LinearLayout
					android:layout_width="match_parent"
					android:layout_height="wrap_content"
					android:orientation="horizontal"
					android:padding="20dp"
					android:gravity="center_vertical">

					<!-- Avatar -->
					<com.google.android.material.card.MaterialCardView
						android:layout_width="120dp"
						android:layout_height="120dp"
						android:layout_marginEnd="30dp"
						app:cardCornerRadius="12dp"
						app:cardElevation="0dp"
						app:strokeWidth="4dp"
						app:strokeColor="@android:color/darker_gray">

						<ImageView
							android:id="@+id/imageViewAvatar"
							android:layout_width="match_parent"
							android:layout_height="match_parent"
							android:src="@drawable/avatar_1"
							android:scaleType="centerCrop"
							app:avatarResource="@{viewModel.avatar}" />

					</com.google.android.material.card.MaterialCardView>

					<!-- User Info -->
					<LinearLayout
						android:layout_width="0dp"
						android:layout_height="wrap_content"
						android:layout_weight="1"
						android:orientation="vertical">

						<TextView
							android:id="@+id/textViewUsername"
							android:layout_width="wrap_content"
							android:layout_height="wrap_content"
							android:text="@{viewModel.username}"
							android:textSize="24sp"
							android:textStyle="bold"
							android:textColor="@android:color/black"
							android:layout_marginBottom="4dp" />

						<!-- Title -->
						<TextView
							android:id="@+id/textViewTitle"
							android:layout_width="wrap_content"
							android:layout_height="wrap_content"
							android:text="@{viewModel.title}"
							android:textSize="16sp"
							android:textStyle="bold"
							android:textColor="@android:color/holo_blue_dark"
							android:layout_marginBottom="8dp" />

						<!-- Level Badge -->
						<LinearLayout
							android:layout_width="wrap_content"
							android:layout_height="wrap_content"
							android:orientation="horizontal"
							android:gravity="center_vertical"
							android:layout_marginBottom="8dp"
							android:background="@drawable/level_badge_background"
							android:padding="8dp">

							<TextView
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="Level"
								android:textSize="14sp"
								android:textStyle="bold"
								android:textColor="@android:color/white"
								android:layout_marginEnd="6dp" />

							<TextView
								android:id="@+id/textViewLevel"
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="@{viewModel.level}"
								android:textSize="16sp"
								android:textStyle="bold"
								android:textColor="@android:color/white" />

						</LinearLayout>

						<!-- XP Display -->
						<LinearLayout
							android:layout_width="wrap_content"
							android:layout_height="wrap_content"
							android:orientation="horizontal"
							android:gravity="center_vertical">

							<TextView
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="XP:"
								android:textSize="16sp"
								android:textStyle="bold"
								android:textColor="@android:color/darker_gray"
								android:layout_marginEnd="8dp" />

							<TextView
								android:id="@+id/textViewXP"
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="@{viewModel.xp}"
								android:textSize="18sp"
								android:textStyle="bold"
								android:textColor="@android:color/black" />

						</LinearLayout>

						<!-- XP Progression Bar (only shown for own profile) -->
						<LinearLayout
							android:layout_width="match_parent"
							android:layout_height="wrap_content"
							android:orientation="vertical"
							android:layout_marginTop="8dp"
							android:layout_marginBottom="8dp"
							android:visibility="@{viewModel.isOwnProfile ? android.view.View.VISIBLE : android.view.View.GONE}">

							<!-- Progress Bar -->
							<LinearLayout
								android:layout_width="match_parent"
								android:layout_height="wrap_content"
								android:orientation="horizontal"
								android:gravity="center_vertical"
								android:layout_marginBottom="4dp">

								<TextView
									android:layout_width="wrap_content"
									android:layout_height="wrap_content"
									android:text="Level Progress:"
									android:textSize="12sp"
									android:textColor="@android:color/darker_gray"
									android:layout_marginEnd="8dp" />

								<TextView
									android:layout_width="wrap_content"
									android:layout_height="wrap_content"
									android:text="@{viewModel.xp + ` / ` + viewModel.totalXpForNextLevel}"
									android:textSize="12sp"
									android:textStyle="bold"
									android:textColor="@android:color/black" />

							</LinearLayout>

							<!-- Progress Bar -->
							<ProgressBar
								android:layout_width="match_parent"
								android:layout_height="8dp"
								style="?android:attr/progressBarStyleHorizontal"
								android:max="100"
								android:progress="@{viewModel.xpProgressPercentage}"
								android:progressTint="?attr/colorPrimary"
								android:backgroundTint="@android:color/darker_gray" />


						</LinearLayout>

					</LinearLayout>

				</LinearLayout>

			</androidx.cardview.widget.CardView>

			<!-- Coins and Power Points Card -->
			<androidx.cardview.widget.CardView
				android:id="@+id/statsCard"
				android:layout_width="match_parent"
				android:layout_height="wrap_content"
				android:layout_marginTop="4dp"
				android:layout_marginStart="16dp"
				android:layout_marginEnd="16dp"
				android:layout_marginBottom="8dp"
				android:elevation="4dp"
				android:visibility="@{viewModel.isOwnProfile ? android.view.View.VISIBLE : android.view.View.GONE}"
				app:cardCornerRadius="12dp"
				app:cardElevation="4dp">

				<LinearLayout
					android:layout_width="match_parent"
					android:layout_height="wrap_content"
					android:orientation="horizontal"
					android:padding="20dp">

					<!-- Coins Section -->
					<LinearLayout
						android:layout_width="0dp"
						android:layout_height="wrap_content"
						android:layout_weight="1"
						android:orientation="horizontal"
						android:gravity="center_vertical"
						android:layout_marginEnd="20dp">

						<ImageView
							android:layout_width="32dp"
							android:layout_height="32dp"
							android:src="@drawable/ic_coin"
							android:layout_marginEnd="12dp"
							android:tint="@android:color/holo_orange_dark" />

						<LinearLayout
							android:layout_width="0dp"
							android:layout_height="wrap_content"
							android:layout_weight="1"
							android:orientation="vertical">

							<TextView
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="Coins"
								android:textSize="14sp"
								android:textColor="@android:color/darker_gray"
								android:layout_marginBottom="2dp" />

							<TextView
								android:id="@+id/textViewCoins"
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="@{viewModel.coins}"
								android:textSize="20sp"
								android:textStyle="bold"
								android:textColor="@android:color/black" />

						</LinearLayout>

					</LinearLayout>

					<!-- Power Points Section -->
					<LinearLayout
						android:layout_width="0dp"
						android:layout_height="wrap_content"
						android:layout_weight="1"
						android:orientation="horizontal"
						android:gravity="center_vertical">

						<ImageView
							android:layout_width="32dp"
							android:layout_height="32dp"
							android:src="@drawable/ic_lightning"
							android:layout_marginEnd="12dp"
							android:tint="@android:color/holo_blue_bright" />

						<LinearLayout
							android:layout_width="0dp"
							android:layout_height="wrap_content"
							android:layout_weight="1"
							android:orientation="vertical">

							<TextView
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="Power Points"
								android:textSize="14sp"
								android:textColor="@android:color/darker_gray"
								android:layout_marginBottom="2dp" />

							<TextView
								android:id="@+id/textViewPowerPoints"
								android:layout_width="wrap_content"
								android:layout_height="wrap_content"
								android:text="@{viewModel.powerPoints}"
								android:textSize="20sp"
								android:textStyle="bold"
								android:textColor="@android:color/black" />

						</LinearLayout>

					</LinearLayout>

				</LinearLayout>

			</androidx.cardview.widget.CardView>

			<!-- QR Code Card -->
			<androidx.cardview.widget.CardView
				android:id="@+id/qrCodeCard"
				android:layout_width="match_parent"
				android:layout_height="wrap_content"
				android:layout_marginTop="4dp"
				android:layout_marginStart="16dp"
				android:layout_marginEnd="16dp"
				android:layout_marginBottom="8dp"
				android:elevation="4dp"
				app:cardCornerRadius="12dp"
				app:cardElevation="4dp">

				<LinearLayout
					android:layout_width="match_parent"
					android:layout_height="wrap_content"
					android:orientation="vertical"
					android:padding="20dp"
					android:gravity="center">

					<!-- Friend Button (only shown for other users) -->
					<com.google.android.material.button.MaterialButton
						android:id="@+id/buttonAddFriend"
						android:layout_width="match_parent"
						android:layout_height="wrap_content"
						android:layout_margin="8dp"
						android:text="Add Friend"
						android:visibility="gone"
						android:textSize="16sp"
						android:textStyle="bold"
						app:cornerRadius="8dp" />

					<TextView
						android:layout_width="wrap_content"
						android:layout_height="wrap_content"
						android:text="Scan this code to add me as a friend"
						android:textSize="14sp"
						android:textColor="@android:color/darker_gray"
						android:gravity="center"
						android:layout_marginBottom="16dp" />

					<!-- QR Code ImageView -->
					<androidx.cardview.widget.CardView
						android:layout_width="200dp"
						android:layout_height="200dp"
						android:layout_gravity="center"
						app:cardCornerRadius="0dp"
						app:cardElevation="0dp">

						<ImageView
							android:id="@+id/imageViewQRCode"
							android:layout_width="match_parent"
							android:layout_height="match_parent"
							android:scaleType="fitCenter"
							android:padding="8dp"
							android:background="@android:color/white"
							app:qrUserId="@{viewModel.userId}"
							android:contentDescription="User QR Code" />

					</androidx.cardview.widget.CardView>

				</LinearLayout>

			</androidx.cardview.widget.CardView>

			<!-- Active Equipment Card -->
			<androidx.cardview.widget.CardView
				android:id="@+id/activeEquipmentCard"
				android:layout_width="match_parent"
				android:layout_height="180dp"
				android:layout_marginTop="4dp"
				android:layout_marginStart="16dp"
				android:layout_marginEnd="16dp"
				android:layout_marginBottom="16dp"
				android:elevation="4dp"
				app:cardCornerRadius="12dp"
				app:cardElevation="4dp">

				<LinearLayout
					android:layout_width="match_parent"
					android:layout_height="wrap_content"
					android:orientation="vertical"
					android:padding="20dp">

					<!-- Active Equipment Title -->
					<TextView
						android:layout_width="wrap_content"
						android:layout_height="wrap_content"
						android:text="Active Equipment"
						android:textSize="18sp"
						android:textStyle="bold"
						android:textColor="@android:color/black"
						android:layout_marginBottom="16dp" />

					<!-- Equipment RecyclerView -->
					<androidx.recyclerview.widget.RecyclerView
						android:id="@+id/recyclerViewActiveEquipment"
						android:layout_width="match_parent"
						android:layout_height="0dp"
						android:layout_weight="1"
						android:orientation="horizontal"
						android:scrollbars="horizontal"
						android:visibility="@{viewModel.activeEquipment != null &amp;&amp; !viewModel.activeEquipment.empty ? android.view.View.VISIBLE : android.view.View.GONE}" />

					<!-- No Equipment Message -->
					<TextView
						android:id="@+id/textViewNoEquipment"
						android:layout_width="match_parent"
						android:layout_height="wrap_content"
						android:text="No active equipment"
						android:textSize="14sp"
						android:textColor="@android:color/darker_gray"
						android:gravity="center"
						android:padding="16dp"
						android:visibility="@{viewModel.activeEquipment == null || viewModel.activeEquipment.empty ? android.view.View.VISIBLE : android.view.View.GONE}" />

				</LinearLayout>

			</androidx.cardview.widget.CardView>

			</LinearLayout>

		</ScrollView>

	</androidx.constraintlayout.widget.ConstraintLayout>
</layout>